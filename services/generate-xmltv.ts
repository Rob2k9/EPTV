import _ from 'lodash';
import xml from 'xml';
import moment from 'moment';

import { db } from './database';

const formatCategories = categories => {
  const tagList = [];
  for (const category of categories){
    tagList.push({
      category: [
        {
          _attr: {
            lang: 'en',
          },
        },
        category
      ]
    });
  }
  return tagList;
}

export const generateXml = async (numChannels: number, startChannel: number) => {
  const wrap: any = {
    tv: [
      {
        _attr: {
          'generator-info-name': 'eptv',
        },
      },
    ],
  };

  _.times(numChannels, i => {
    const channelNum = startChannel + i;
    wrap.tv.push({
      channel: [
        {
          _attr: {
            id: `${channelNum}.eptv`,
          },
        },
        {
          'display-name': [
            {
              _attr: {
                lang: 'en',
              },
            },
            `ESPN Plus ${channelNum}`,
          ]
        },
        {
          icon: [
            {
              _attr: {
                src: 'data:image/png;base64,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',
              },
            },
          ],
        },
      ]
    });
  });

  const scheduledEntries = await db.entries.find({channel: {$exists: true}}).sort({start: 1});

  for (const entry of scheduledEntries) {
    const channelNum = (entry as any).channel;

    wrap.tv.push({
      programme: [
        {
          _attr: {
            channel: `${channelNum}.eptv`,
            start: moment((entry as any).start).format('YYYYMMDDHHmmss ZZ'),
            stop: moment((entry as any).end).format('YYYYMMDDHHmmss ZZ'),
          },
        },
        {
          title: [
            {
              _attr: {
                lang: 'en',
              },
            },
            (entry as any).name,
          ],
        },
        {
          desc: [
            {
              _attr: {
                lang: 'en',
              },
            },
            (entry as any).name,
          ]
        },
        {
          icon: [
            {
              _attr: {
                src: (entry as any).image,
              },
            },
          ],
        },
        {
          live: [
            {},
            '',
          ],
        },
        {
          new: [
            {},
            '',
          ],
        },
        ...formatCategories((entry as any).categories)
      ],
    });
  }

  return xml(wrap);
}
